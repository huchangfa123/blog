{% extends './base.html' %}
{% block body %}
 <h1>写文章</h1><br>
 <div>
  <label>标题</label> <input id = "title" type="text"> 
 </div>
 <div id = "write_body">
    <textarea rows="25" cols="70" id ="content"></textarea>
    <button id = "save">存草稿</button>
    <button id = "pass">提交</button>
 </div>
  <script>
    function getNowFormatDate() {
      var date = new Date();
      var seperator1 = "-";
      var seperator2 = ":";
      var month = date.getMonth() + 1;
      var strDate = date.getDate();
      if (month >= 1 && month <= 9) {
          month = "0" + month;
      }
      if (strDate >= 0 && strDate <= 9) {
          strDate = "0" + strDate;
      }
      var currentdate = date.getFullYear() + seperator1 + month + seperator1 + strDate
              + " " + date.getHours() + seperator2 + date.getMinutes()
              + seperator2 + date.getSeconds();
      return currentdate;
    }
    $(function(){
      var simplemde = new SimpleMDE();
      var isDraft = false;
      //判断是否为草稿
      $("#save").click(function (){
        isDraft = true;
        $.post("/console/write",
        {
          title : $("#title").val(),
          content : simplemde.value(),
          draft : isDraft
        },
      function (data, status){
        if(status){
          window.location.href = "/write"
        }
        })
      })
      //上传文章
      $("#pass").click(function (){
        let date = getNowFormatDate()
        $.post("/write",
        {
          title : $("#title").val(),
          content : simplemde.value(),
          draft : isDraft,
          date: date
        },
        function (data, status){
          if(status){
            window.location.href = "/write"
          }
        })
      })
    })
  </script> 
{% endblock %}